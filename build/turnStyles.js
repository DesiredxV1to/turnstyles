!function(){var t=function(t){var e;return function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports}},e=t((function(t,e){t.exports=t=>{t.nextDJ=function(){if(this.config.nextdj)return $(".become-dj").length?(this.Log("nextdj: attempting jump"),void this.View().becomeDj()):this.Log("nextdj: no spot")},t.spinning=function(t){if(!this.config.nextdj)return;if(this.User().id!=t.user[0].userid)return;this.setConfig("nextdj",!1);let e="You've hopped on deck!",n="NextDJ has been disabled.";this.Notify({head:e,body:n}),this.Post({head:e,body:n})},t.autoQueue=function(t){this.config.auto_q&&t.text==this.config.q_text&&this.View().becomeDj()},t.on("add_dj",t.spinning),t.on(["update","rem_dj"],t.nextDJ),t.on(["speak","pmmed"],t.autoQueue)}})),n=t((function(t,e){t.exports=t=>{t.sendReminder=function(t){if(!this.config.timing.text)return;let e=parseInt(this.config.timing.post),n=`[${this.Room().name}] ${this.config.timing.text}`;t%e==0&&this.config.timing.text&&this.Chat(n)},t.on("heartbeat",t.sendReminder)}})),s=t((function(t,e){t.exports=t=>{t.autoBop=function(){if(this.bop&&clearTimeout(this.bop),!this.config.auto_b)return;const t=7*Math.random()*100;this.bop=setTimeout(()=>n(".awesome-button"),t)},t.on("newsong",t.autoBop)};const n=t=>{$(window).focus();const e={bubbles:!0,cancelable:!0,view:window},n=document.querySelectorAll(t)[0],s=new MouseEvent("click",e);return!n.dispatchEvent(s)}})),o=t((function(t,e){t.exports=t=>{t.setAfk=function(t,e,n){"is_afk"!=t||n||e&&this.config.afkstr&&this.isAfk()},t.isAfk=function(){this.config.afkstr&&this.Batch(this.config.afkstr)},t.getAfk=function(t){if(!this.config.is_afk)return;let e=this.config.afkstr.split(";;").map(t=>t.trim());!t.$self&&t.$ping?this.isAfk():t.$self&&!e.includes(t.text)&&(this.setConfig("is_afk",!1),this.Post({head:"Welcome Back!",body:"You're no longer AFK!"}))},t.on("speak",t.getAfk),t.on("update",t.setAfk)}})),i=t((function(t,e){t.exports=t=>{t.songStats=function(t){let e=this.last_played;this.config.alerts.song&&t&&this.Post({head:t,body:`${e.song} by ${e.artist}`,type:"stat"})},t.djStats=function(t,e){this.config.alerts.spun&&this.Post({head:`${t} - ${e}`,body:" - is done spinning!",type:"stat"})},t.userStats=function(t){$(".profile.modal .statslink").length||($(".profile.modal .section.web-links").show(),$(".profile.modal .website").append(n(t)))},t.on("tracked",t.songStats),t.on("dropped",t.djStats),t.on("profile",t.userStats)};const n=t=>`\n  <a target="_blank" class="statslink" onclick="$('.modal .close-x')[0].click()"\n    href="https://thompsn.com/turntable/leaderboard/thing/?id=${t}">\n    Leaderboard\n  </a>\n`})),a=t((function(t,e){t.exports=t=>{t.notifyPMs=function(t){this.config.notify.chat&&this.Notify({head:"New PM "+(t.$from?"from: "+t.$from:""),body:t.text,type:"pm_ping"})},t.notifyDings=function(t){this.config.notify.ding&&t.$ping&&this.Notify({head:`[${this.view().roomData.name}] @${t.name}`,body:t.text,type:"chat_ping"}),this.notifyText(t)},t.notifySong=function(){let t=this.now_playing;this.config.notify.song&&t.song&&this.Notify({head:"Now Playing: "+t.song,body:"By: "+t.artist})},t.notifyText=function(t){let e=t.text.toLowerCase();if(this.config.notify.text.length<3)return;let n=this.config.notify.text.toLowerCase().split(",");for(let s of n)if(e.indexOf(s.trim())>-1)return $(".chat .messages .message:last-child").addClass("mention"),this.Notify({head:`Hot Word: "${s}"`,body:t.text})},t.alertSnags=function(t){this.config.alerts.snag&&this.Post({head:t.$name,body:"has snagged this track!",type:"snag"})},t.alertJoin=function(t){if(this.config.alerts.join)for(let e of t.user)this.Post({head:e.name,body:"joined.",type:"join"})},t.alertLeft=function(t){if(this.config.alerts.left)for(let e of t.user)this.Post({head:e.name,body:"left.",type:"left"})},t.on("pmmed",t.notifyPMs),t.on("speak",t.notifyDings),t.on("tracked",t.notifySong),t.on("snagged",t.alertSnags),t.on("registered",t.alertJoin),t.on("deregistered",t.alertLeft)}})),l=t((function(t,e){t.exports=t=>{t.bindPlaylist=function(){this.countPlaylist(),this.checkPlaylist(),this.classes("played",this.config.played)},t.countPlaylist=function(){let t=$("#playlist-header .text")[0],e=window.playlist.fileids.length,n=t.innerHTML.split("<em>")[0];t.innerHTML=`${n} <em>${e}</em>`},t.checkPlaylist=function(){if($(".song.ts_played").removeClass("ts_played"),!this.config.played)return;let t=this.Room().metadata.songlog;$("#queue .songs .song").each((function(){let e=$(this),n=e.find(".title").text(),s=e.find(".details").text().split(" \u2022 ")[0];for(let o of t){let{song:t,artist:i}=o.metadata;t==n&&i==s&&e.addClass("ts_played")}}))},t.updatePlaylist=function(t,e){"played"==t&&this.classes("played",e)},t.on("update",t.updatePlaylist),t.on("playlist",t.countPlaylist),t.on(["tracked","playlist"],t.checkPlaylist)}})),r=t((function(t,e){t.exports=t=>{t.qtbtns=function(t){let e=this.config.qtbtns["qtbtn"+t];e&&(e.indexOf("||")>-1&&(e=e.split("||")[1].trim()),this.Batch(e))},t.qtbtn1=function(){this.qtbtns("1")},t.qtbtn2=function(){this.qtbtns("2")},t.qtbtn3=function(){this.qtbtns("3")}}})),h=t((function(t,e){t.exports=t=>{t.fadeNewSong=function(t){let e=$(t).children(".message").last(),n=e.has(".avatar").length,s=e[0].innerText.includes("started playing");!n&&s&&e.addClass("stat")},t.addTimeStamp=function(t){if(!this.config.stamps)return;let e=$(".chat .messages .message:last-of-type"),n=0===e[0].innerText.indexOf(t.name),s=e.has(".timestamp").length;if(n&&!s){let t=this.now().split(":").slice(0,2).join(":");e.prepend(`<div class="timestamp">${t}</div>`)}},t.on("speak",t.addTimeStamp),t.on("newchat",t.fadeNewSong)}})),d=t((function(t,e){t.exports=t=>{const e=t=>Math.log(t/100)/Math.LN2+4,s=t=>{let e=t||window.util.getSetting("volume");return 100*Math.pow(2,e-4)};t.loadVolume=function(){let t=this.config.volume,e=$("body").hasClass("ts_vol");this.classes("ts_vol",t);let n=window.turntablePlayer.realVolume;this.realVolume||(this.realVolume=n),t&&!e&&this.addVolume(),e&&!t&&this.remVolume()},t.addVolume=function(){$(".header-content").append(n(s())),$("#tsMute").on("click",this.muteVolume.bind(this)),$("#tsSlider").on("input",this.saveVolume.bind(this)),$("#tsSlider").on("DOMMouseScroll mousewheel",this.rollVolume.bind(this))},t.remVolume=function(){$("#tsVolume").remove(),window.turntablePlayer.realVolume=this.realVolume},t.saveVolume=function(t){let n=(t=t.target?t.target.value:t)>0?e(t):-7,o=n<7?s:this.realVolume;window.turntablePlayer.realVolume=o,window.turntablePlayer.setVolume(n),window.util.setSetting("volume",n)},t.rollVolume=function(t){let e=s(),n=t.originalEvent.deltaY>0,o=t.originalEvent.shiftKey?1:5,i=n?e-o:e+o;return i=i<0?0:i>100?100:i,$("#tsSlider")[0].value=i,this.saveVolume(i),!1},t.muteVolume=function(){this.muted=!this.muted,this.classes("ts_muted",this.muted);let t=this.muted?-3:e(s());window.turntablePlayer.setVolume(t),this.Log("turned mute "+(this.muted?"on":"off"))},t.checkMuted=function(){this.muted&&this.muteVolume()},t.fixMusic=()=>{let t=window.youtube,e=window.soundcloudplayer;e.song&&(e.songTime=e.player.currentTime()/1e3,e.previewStartTime=Date.now()-1e3,e.resumeSong(e.song)),t.song&&(t.songTime=t.player[0].getCurrentTime(),t.previewStartTime=Date.now()-3e3,t.resumeSong(t.song)),$("#tsPanel").removeClass("active")},t.on("attach",t.loadVolume),t.on("update",t.loadVolume),t.on("nosong",t.checkMuted),t.on("newsong",t.checkMuted)};const n=t=>`\n  <div id="tsVolume">\n    <span id="tsMute"></span>\n    <input id="tsSlider" type="range" min="0" max="100" value="${t}">\n    <em id="tsMuted">Muted For One Song</em>\n  </div>\n`})),u=t((function(t,e){t.exports=t=>{t.loadClasses=function(t){this.classes("logger",t.logger),this.classes("no_bub",!t.bubble),this.classes("no_aud",!t.people),this.classes("no_vid",!t.player),this.classes("hb-is_afk",!t.hotbar.is_afk),this.classes("hb-auto_b",!t.hotbar.auto_b),this.classes("hb-auto_q",!t.hotbar.auto_q),this.classes("hb-nextdj",!t.hotbar.nextdj),this.classes("hb-bubble",!t.hotbar.bubble),this.classes("hb-people",!t.hotbar.people),this.classes("hb-player",!t.hotbar.player),this.classes("hb-qtbtn1",!t.hotbar.qtbtn1),this.classes("hb-qtbtn2",!t.hotbar.qtbtn2),this.classes("hb-qtbtn3",!t.hotbar.qtbtn3)},t.updateClasses=function(t,e,n){"bubble"==t&&this.classes("no_bub",!e),"player"==t&&this.classes("no_vid",!e),"people"==t&&this.classes("no_aud",!e),"logger"==t&&this.classes("logger",e),"hotbar"==n&&("is_afk"==t&&this.classes("hb-is_afk",!e),"auto_b"==t&&this.classes("hb-auto_b",!e),"auto_q"==t&&this.classes("hb-auto_q",!e),"nextdj"==t&&this.classes("hb-nextdj",!e),"bubble"==t&&this.classes("hb-bubble",!e),"people"==t&&this.classes("hb-people",!e),"player"==t&&this.classes("hb-player",!e),"qtbtn1"==t&&this.classes("hb-qtbtn1",!e),"qtbtn2"==t&&this.classes("hb-qtbtn2",!e),"qtbtn3"==t&&this.classes("hb-qtbtn3",!e)),"hotbar"!=n&&"qtbtns"!=n||this.bindHotBar()},t.on("update",t.updateClasses)}})),c=t((function(t,e){t.exports=t=>{t.loadThemes=function(t){$("#ts_core, #ts_themes, #ts_styles, #ts_css").remove(),this.insert("turnStyles"),this.insert(t.theme,"themes"),this.insert(t.style,"styles"),this.inject(t.u_css),this.themed(t.theme)},t.updateThemes=function(t,e){"theme"==t&&this.themed(e),"theme"==t&&this.insert(e,"themes"),"style"==t&&this.insert(e,"styles"),"u_css"==t&&this.inject(e)},t.insert=function(t,e){let s=`${this.__base}${e?"/"+e:""}`,o=t?`${s}/${t}.css?v=${Math.random()}`:"#",i="ts_"+(e||"core"),a=$("#"+i);a.length?a.attr("href",o):document.head.append(n(i,o)),"#"!=o&&this.Log("inserted: "+o.split("?v")[0])},t.inject=function(t){let e=$("#ts_css");e.length?e[0].innerHTML=t:document.head.append(s(t)),t&&this.Log("injected: "+t)},t.themed=function(t){this.classes("th-none",!t);let e=$("body").data("theme");e&&$("body").removeClass("th-"+e),t&&$("body").addClass("th-"+t),$("body").data("theme",t)},t.on("update",t.updateThemes)};const n=(t,e)=>{let n=document.createElement("link");return n.id=t,n.type="text/css",n.rel="stylesheet",n.href=e,n},s=t=>{let e=document.createElement("style");return e.id="ts_css",e.type="text/css",e.innerHTML=t,e}})),g=t((function(t,e){t.exports=t=>{t.bindWindow=function(){$("#tsWindow").remove(),$("body").append(`<div id="tsWindow">${e()}</div>`),$("#tsClose").on("click",()=>$("#tsWindow").removeClass("active")),$("#tsWindow *[data-for]").on("click",this.saveConfig.bind(this)),$("#tsWindow *[data-opt]").on("change",this.saveConfig.bind(this)),$(".ts-tab").on("click",t=>{let e=t.target.dataset.tab;$("#tsWindow .active").removeClass("active"),$(`*[data-tab="${e}"]`).addClass("active")}),$("#tsBackup input").on("change",this.uploadData),$("#tsWindow").on("click",(function(t){t.target==this&&$("#tsWindow").removeClass("active")}))};const e=()=>`\n    <div id="tsConfig">\n      <nav>\n        <h2><span id="tsClose">\u2716</span>turnStyles</h2>\n        ${t.tabs.map(t=>`\n            <div data-tab="${t}" \n              class="ts-tab ${"General"==t?"active":""}">\n              ${t}\n            </div>`).join("")}\n      </nav>\n      ${t.tabs.map(e=>t.tabbed[e]()).join("")}\n    </div>\n  `}})),p=t((function(t,e){t.exports=t=>{t.bindHotBar=function(){$("#tsHotBar").remove(),$(".header-bar").append(e()),$("#tsOpen").on("click",()=>$("#tsWindow").addClass("active")),$("#tsHotBar *[data-for]").on("click",this.saveConfig.bind(this)),$("#tsHotBar *[data-opt]").on("change",this.saveConfig.bind(this))};const e=()=>`\n    <div id="tsHotBar">\n      ${t.$button("\u2630",!1,"tsOpen")}\n      ${t.$toggle("is_afk","AFK",!1,"hbIsAfk")}\n      ${t.$toggle("auto_b","Autobop",!1,"hbAutoB")}\n      ${t.$toggle("auto_q","AutoQueue",!1,"hbAutoQ")}\n      ${t.$toggle("nextdj","Next DJ",!1,"hbNextDJ")}\n\n      ${t.$qtbtn("1")} ${t.$qtbtn("2")} ${t.$qtbtn("3")}\n\n      ${t.$toggle("bubble","Bubbles",!1,"hbBubbles")}\n      ${t.$toggle("people","People",!1,"hbPeople")}\n      ${t.$toggle("player","Player",!1,"hbPlayer")}\n    </div>\n  `}})),f=t((function(t,e){t.exports=t=>{t.tabs=["General","Visual","Hotbar","Alerts","Support"],t.tabbed={General:()=>n("General",`\n      <h3>Automate</h3>\n      <h5>${t.$toggle("auto_b","Enable Autobop")}</h5>\n      <p>Vote "Awesome" after every new song starts, automatically!</p>\n\n      <h5>${t.$toggle("nextdj","Take Next DJ Spot")}</h5>\n      <p>turnStyles will attempt to add you as a DJ when a spot becomes available.</p>\n\n      <h5>${t.$toggle("auto_q","Enable AutoQueue")}</h5>\n      ${t.$string("q_text","Save Queue Ping")}\n      <p>For bots with a queue: Paste your queue ping above to auto DJ on ping!</p>\n\n      <h3>General</h3>\n      <h5>${t.$toggle("is_afk","Currently AFK")}</h5>\n      ${t.$string("afkstr","Save AFK Response")}\n      <p>Sends the AFK Response when you go AFK, and when you're pinged while AFK.</p>\n\n      <h5>${t.$toggle("volume","Override Volume")}</h5>\n      <p>Move volume controls out of the menu, and adds Mute For One Song.</p>\n    `,!0),Visual:()=>n("Visual",`\n      <h3>Theme/Style</h3>\n      ${t.$select("theme")}\n      ${t.$select("style")}\n\n      <h3>Visual Tweaks</h3>\n      <h5>${t.$toggle("played","Show Recently Played")}</h5>\n      <p>Highlights songs in playlist that were recently played in the room.</p>\n\n      <h5>${t.$toggle("stamps","Add Timestamps To Chat")}</h5>\n      <p>Adds a timestamp to the right of room chat messages.</p>\n\n      <h3>Turntable</h3>\n      ${t.$toggle("bubble","Show Chat Bubbles")}\n      ${t.$toggle("people","Show Room Audience")}\n      ${t.$toggle("player","Show Video Player")}\n\n      <h3>Custom CSS</h3>\n      ${t.$field("u_css","Save & Apply Styles")}\n      <p>Add your own custom CSS snippets to turntable!</p>\n    `),Hotbar:()=>n("Hotbar",`\n      <h3>QuickText</h3>\n      <h5>${t.$toggle("qtbtn1","Enable QT 1","hotbar")}</h5>\n      ${t.$string("qtbtn1","Save QT 1","qtbtns")}\n      <p>Send your most common messages at the push of a button!</p>\n\n      <h5>${t.$toggle("qtbtn2","Enable QT 2","hotbar")}</h5>\n      ${t.$string("qtbtn2","Save QT 2","qtbtns")}\n      <p>Prefix with <strong>label || </strong> to add a button label!</p>\n      <kbd>hello || hello world!</kbd>\n\n      <h5>${t.$toggle("qtbtn3","Enable QT 3","hotbar")}</h5>\n      ${t.$string("qtbtn3","Save QT 3","qtbtns")}\n      <p>Send multiple by adding <strong>;;</strong></p>\n      <kbd>welcome || Hello! || Rules! || Gif!</kbd>\n\n      <h3>Show In Hotbar</h3>\n      ${t.$toggle("is_afk","AFK","hotbar")}\n      ${t.$toggle("auto_b","Autobop","hotbar")}\n      ${t.$toggle("auto_q","AutoQueue","hotbar")}\n      ${t.$toggle("nextdj","Next DJ","hotbar")}\n      ${t.$toggle("bubble","Chat Bubble Toggle","hotbar")}\n      ${t.$toggle("people","Audience Toggle","hotbar")}\n      ${t.$toggle("player","Player Toggle","hotbar")}\n    `),Alerts:()=>n("Alerts",`\n      <h3>Hot Words</h3>\n      ${t.$string("text","Save Hot Words","notify")}\n      <p>Desktop Notifications/Highlight Message on word match in chat. Use more than one in a comma separated list.</p>\n\n      <h3>Notify</h3>\n      ${t.$toggle("chat","On New PM","notify")}\n      ${t.$toggle("ding","On New Mention","notify")}\n      ${t.$toggle("song","On New Songs","notify")}\n      <p>Send Desktop Notifications</p>\n\n      <h3>Alerts</h3>\n      ${t.$toggle("song","Last Song Stats","alerts")}\n      ${t.$toggle("spun","Last DJ Stats","alerts")}\n      ${t.$toggle("snag","Song Snags","alerts")}\n      ${t.$toggle("join","On User Join","alerts")}\n      ${t.$toggle("left","On User Leave","alerts")}\n      <p>Alerts show up in room chat but are only visible to you.</p>\n\n      <h3>Reminder</h3>\n      ${t.$select("remind","timing")}\n      ${t.$string("text","Save Reminder","timing")}\n      <p>Sends Reminder to room at the selected interval! Useful for themes, rules, whatever you like!</p>\n    `),Support:()=>n("Support",`\n      <h3>Debug</h3>\n      ${t.$toggle("debug","Print Logs In Console")}\n      ${t.$toggle("logger","Show Logs In Room Tab")}\n      <div style="width: 0px;height: 10px;"></div>\n      ${t.$button("Reload turnStyles",!1,!1,"reload")}\n      ${t.$button("Reload Players",!1,!1,"reloadMusic")}\n      ${t.$button("Reset Data",!1,!1,"resetData")}\n\n      <h3>Backup</h3>\n      ${t.$button("Download Backup",!1,!1,"backupData")}\n      <label id="tsBackup" class="ts-button"><input type="file">Restore Backup</label>\n\n      <h3>Support</h3>\n      <a href="https://discord.gg/wqmAVvgSbE" class="ts-button" target="_blank">turnStyles Discord</a>\n      <a href="https://discord.gg/jnRs4WnPjM" class="ts-button" target="_blank">turntable.fm Discord</a>\n\n      <h3>Sharing</h3>\n      <a href="https://chrome.google.com/webstore/detail/turntable-tweaks/pmlkackfnbbnjfejpddpakallilkbdme" class="ts-button" target="_blank">Chrome / Opera</a>\n      <a href="https://addons.mozilla.org/en-US/firefox/addon/turnstyles-for-turntable-fm/" class="ts-button" target="_blank">Firefox</a>\n      <a href="https://ts.pixelcrisis.co" class="ts-button" target="_blank">Bookmarklet</a>\n      <a href="https://ts.pixelcrisis.co" class="ts-button" target="_blank">Beta</a>\n\n      <h3>Author</h3>\n      <em>turnStyles v${t.config.version}<em><br />\n      <strong>@crisis</strong> on Discord<br />\n      <strong>@crisis</strong> on Turntable<br />\n      <a target="_blank" href="https://patreon.com/pixelcrisis">patreon.com/pixelcrisis</a><br />\n      <em>Request Themes & More on Patreon!</em>\n    `)}};const n=(t,e,n)=>`\n  <div class="ts-tabbed ${n?"active":""}" \n    data-tab="${t}">${e}</div>\n`})),b=t((function(t,e){t.exports=t=>{t.$button=(t,e,n,s)=>`\n    <button class="ts-button" ${n?`id="${n}"`:""}\n      ${e?`data-for="${e}"`:""}\n      ${s?`onclick="$tS.${s}()"`:""}>\n      ${t}\n    </button>\n  `,t.$toggle=function(t,e,s,o){return`\n    <label class="ts-toggle" ${o?`id="${o}"`:""}>\n      <input type="checkbox" \n        data-opt="${t}" data-cat="${s||""}"\n        ${n(this.config,t,s)?"checked":""} />\n      <span></span> ${e}\n    </label>`},t.$string=function(t,e,s){return`\n    <input type="text" class="ts-inputs"\n      data-opt="${t}" data-cat="${s||""}"\n      value="${n(this.config,t,s)}" />\n    ${this.$button(e,t)}`},t.$field=function(t,e,s){return`\n    <textarea class="ts-inputs" rows="10"\n      data-opt="${t}" data-cat=${s||""}>\n      ${n(this.config,t,s)}\n    </textarea>\n    ${this.$button(e,t)}`},t.$select=function(t,e){return`\n    <select class="ts-choice"\n      data-opt="${t}" data-cat="${e||""}">\n      <option value="">No ${this.cap(t)}</option>\n      ${s(this.options,this.config,t,e)}\n    </select>`},t.$qtbtn=function(t){let e="qtbtn"+t,n=this.config.qtbtns[e],s="QT"+t;return n.indexOf("||")>-1&&(s=(n=n.split("||")).shift(),n=n.join(" ")),this.$button(s,!1,e,e)}};const n=function(t,e,n){return n?t[n][e]:t[e]},s=function(t,e,s,o){let i=n(e,s,o);return Object.keys(t[s]).map(e=>{let n=t[s][e];return`<option value="${e}" ${e==i?"selected":""}>${n}</option>`}).join("")}})),m=t((function(t,e){t.exports={version:"10.5.1"}})),y=t((function(t,e){t.exports=t=>{t.initCache=function(t){this.current_djs={},this.now_playing={},this.last_played={},this.cacheSong(t.currentSong);for(let e of t.djids)this.cacheDJ(e)},t.cacheDJ=function(t){let e=t.user?t.user[0].userid:t;this.current_djs[e]||(this.current_djs[e]=n())},t.updateDJ=function(t){if(!t.song||!t.djid)return;let e=this.current_djs[t.djid],s=n(e,{...t,spun:1});this.current_djs[t.djid]=s},t.resetDJ=function(t){let e=t.user[0].userid,n=s(this.current_djs[e]);delete this.current_djs[e],this.Emit("dropped",t.user[0].name,n)},t.cacheSong=function(t){let e=t&&t.room?t.room.metadata.current_song:t,n=t&&t.upvoters?t.upvoters.length:0,o=!!e&&e.djid,i={...this.now_playing},a={djid:o,love:n,hate:0,snag:0},l=e?{...e.metadata,...a}:{};this.now_playing=l,this.last_played=i,this.updateDJ(i);let r=l.song||"none";this.Log("new song: "+r),this.Emit("tracked",s(i))},t.cacheVote=function(t){this.now_playing.love=t.room.metadata.upvotes,this.now_playing.hate=t.room.metadata.downvotes},t.cacheSnag=function(){this.now_playing.snag+=1},t.on("attach",t.initCache),t.on("add_dj",t.cacheDJ),t.on("rem_dj",t.resetDJ),t.on("snagged",t.cacheSnag),t.on("update_votes",t.cacheVote),t.on(["nosong","newsong"],t.cacheSong)};const n=(t,e)=>{let n={spun:0,love:0,hate:0,snag:0};for(let s in t||{})s in n&&(n[s]+=t[s]);for(let s in e||{})s in n&&(n[s]+=e[s]);return n},s=(t={},e="")=>("love"in t&&(e+=t.love+"\u2764\ufe0f"),"hate"in t&&(e+=t.hate+"\ud83d\udc94"),"snag"in t&&(e+=t.snag+"\ud83d\udc96"),"spun"in t&&(e+=t.spun+"\u25b6\ufe0f"),e)})),w=t((function(t,e){t.exports=t=>{t.resetData=function(t){t=t||this.default;for(let n in t)this.config[n]=t[n];let e=JSON.stringify(this.config);window.localStorage.setItem("tsdb",e),this.reload()},t.backupData=function(){let t=JSON.stringify(this.config),e=new Blob([t],{type:"text/json"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(e,"tsdb.json");else{let t=window.document.createElement("a");t.href=window.URL.createObjectURL(e),t.download="tsdb.json",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},t.uploadData=function(){let e=$("#tsBackup input")[0].files[0];if(!e)return alert("Select Backup File First");let n=new FileReader;n.onload=t.restoreData,n.readAsText(e)},t.restoreData=function(e){let n=JSON.parse(e.target.result);n.hotbar&&n.people?t.resetData(n):alert("Error Reading Backup File")}}})),v=t((function(t,e){t.exports=t=>{t.migrate=function(t){for(let e of n)t=e(t);return t}};const n=[function(t){return s(t,{user_css:{map:"u_css"},autobop:{map:"auto_b"},logging:{map:"logger"},has_vol:{map:"volume"},q_ping:{map:"q_text"},afk_ping:{map:"afkstr"},no_aud:{map:"people",flip:!0},no_vid:{map:"player",flip:!0},no_bub:{map:"bubble",flip:!0},ping_pm:{map:"chat",cat:"notify"},ping_song:{map:"song",cat:"notify"},ping_chat:{map:"ding",cat:"notify"},hot_words:{map:"text",cat:"notify"},chat_song:{map:"song",cat:"alerts"},chat_spun:{map:"spun",cat:"alerts"},chat_snag:{map:"snag",cat:"alerts"},chat_join:{map:"join",cat:"alerts"},chat_left:{map:"left",cat:"alerts"},beats:{map:"beat",cat:"timing"},remind:{map:"post",cat:"timing"},reminder:{map:"text",cat:"timing"}})}],s=function(t,e){for(let n in e){let{map:s,cat:o,flip:i}=e[n];if(n in t){let e=i?!t[n]:t[n];o?t[o]?t[o][s]=t[n]:t[o]={[s]:t[n]}:t[s]=e,delete t[n]}}return t}})),_=t((function(t,e){t.exports=t=>{t.default={debug:!1,theme:"dark",style:"",u_css:"",is_afk:!1,afkstr:"I'm AFK - Back in a sec!",people:!0,player:!0,bubble:!0,logger:!1,volume:!1,played:!1,stamps:!1,auto_b:!0,nextdj:!1,auto_q:!1,q_text:"Hey @user - it's your turn!",notify:{song:!1,ding:!1,chat:!1,text:""},alerts:{song:!1,spun:!1,snag:!1,join:!1,left:!1},hotbar:{is_afk:!0,auto_b:!0,auto_q:!0,nextdj:!0,bubble:!1,people:!1,player:!1,qtbtn1:!1,qtbtn2:!1,qtbtn3:!1},qtbtns:{qtbtn1:"",qtbtn2:"",qtbtn3:""},timing:{beat:0,post:0,text:"Today's theme is: Cool."}},t.options={theme:{dark:"Dark Mode",night:"Night Mode",cosmic:"Cosmic",forest:"Forest",midnight:"Midnight"},style:{blue:"Blue",pink:"Pink",green:"Green",purple:"Purple",teal:"Teal"},remind:{0:"Don't Remind",15:"Every 15m",30:"Every 30m",60:"Every 1h",120:"Every 2h"}}}})),k=t((function(t,e){t.exports=t=>{t.attach=function(){this.initConfig();const e=window.turntable;if(!e)return this.Log("No room");const s=window.turntable.user;if(this.lobby=$("#turntable #topBG").length,this.lobby)return this.bindHotBar(),this.bindWindow(),!1;const o=()=>setTimeout(t.attach.bind(this),150);if(!s)return o();let i=n(e,"roomId");return i&&n(i,"roomData")?(this.listener=this.listen.bind(this),window.turntable.addEventListener("message",this.listener),this.Emit("attach",i),void this.Log("loaded room")):o()},t.reload=function(){clearInterval(this.heart),window.turntable.removeEventListener("message",this.listener),$('script[src*="turnStyles.js"]').remove();const t=document.createElement("script");t.src=`${this.__base}/turnStyles.js?v=${Math.random()}`,t.type="text/javascript",this.Log("reloading"),document.body.append(t)}};const n=(t,e)=>{for(let s in t)if(null!=(n=t[s])&&n[e])return t[s];var n}})),x=t((function(t,e){t.exports=t=>{t.Notify=function(t){if(!this.canNotify()||document.hasFocus())return;let{head:e,body:n,type:s}=t,o=this.__logo,i=()=>{let t=new Notification(e,{icon:o,body:n});t.onclick=()=>{window.focus(),t.close()}};return s?this.delay(i,5,s):i()},t.canNotify=function(){let t=this.config.notify;return!(!(t.chat||t.song||t.ding)||!("Notification"in window)||"denied"===Notification.permission||"default"===Notification.permission&&(this.Log("requesting notification permissions"),Notification.requestPermission(),1))},t.on("update",t.canNotify)}})),S=t((function(t,e){t.exports=t=>{t.Log=function(t){this.config.debug&&console.info(`[${this.now()}] turnStyles :: ${t}`),t=n(t),this.logbook||(this.logbook=[]),this.logbook.push(`[tS - ${this.now()}] <span>${t}</span>`),this.logbook.length>50&&this.logbook.shift();let e=$("#tsLogs")[0];e&&(e.innerHTML=this.logbook.reverse().join("<br>"),e.scrollTop=e.scrollHeight)},t.bindLogs=function(){$("#tsLogs").remove(),$(".room-info-nav").after('<div id="tsLogs"></div>')},t.on("update",(function(t,e){this.Log(`update: [${t}] to (${e})`)})),t.on("registered",(function(t){for(let e of t.user)this.Log(`[${e.name}](${e.userid}) joined.`)})),t.on("deregistered",(function(t){for(let e of t.user)this.Log(`[${e.name}](${e.userid}) left.`)})),t.on("add_dj",(function(t){let e=t.user[0].userid;this.Log(`add dj: [${this.findName(e)}](${e})`)})),t.on("rem_dj",(function(t){let e=t.user[0].userid;this.Log(`rem dj: [${this.findName(e)}](${e})`)})),t.on("update_votes",(function(t){let e=t.room.metadata.votelog,n=e[e.length-1];this.Log(`[${this.findName(n[0])}] voted: ${n[1]}`)}))};const n=t=>{if(0==t.indexOf("inserted:")){let e=t.split("/");return"inserted: "+e[e.length-1]}return t}})),j=t((function(t,e){t.exports=t=>{t.beat=function(){let t=parseInt(this.config.timing.beat)+1;this.config.timing.beat=t,this.Emit("heartbeat",t)},t.bindTimer=function(){this.holding={},this.heart=setInterval(t.beat.bind(this),6e4)},t.delay=function(t,e,n){if(this.holding||(this.holding={}),this.holding[n])return;let s=1e3*e;this.holding[n]=setTimeout((()=>{delete this.holding[n]}).bind(this),s),t&&t()}}})),C=t((function(t,e){t.exports=t=>{t.on=function(t,...e){this.events||(this.events={}),Array.isArray(t)||(t=[t]);for(let n of t){this.events[n]||(this.events[n]=[]);for(let t of e)this.events[n].push(t.bind(this))}},t.Emit=function(t,...e){let n=this.events[t];if(n)for(let s of n)s(...e)},t.listen=function(t){t.command&&(t.$ping=this.findPing(t.text),t.$name=this.findName(t.userid),t.$from=this.findName(t.senderid),t.$self=this.User().id==t.userid,this.Emit(t.command,t))},t.watcher=function(){new(window.MutationObserver||window.WebKitMutationObserver)((function(e){for(let n of e){let e=n.target;"songs"==e.className&&t.Emit("playlist"),"messages"==e.className&&t.Emit("newchat",e),"TITLE"==e.nodeName&&e.baseURI.indexOf("profile/")>-1&&t.Emit("profile",e.baseURI.split("profile/")[1])}})).observe(document,{subtree:!0,childList:!0})},t.on("attach",t.watcher)}})),q=t((function(t,e){t.exports=t=>{t.User=()=>window.turntable.user,t.View=()=>window.turntable.topViewController,t.Chat=()=>window.turntable.buddyList.pmWindows,t.Room=()=>window.turntable.topViewController.roomData,t.findName=function(t="Unknown"){let e=this.View().userMap[t];if(e)return e.attributes.name;let n=!!this.Chat()&&this.Chat()[t];return n?n.otherUser.attributes.name:t},t.findPing=function(t=""){let e="@"+this.User().attributes.name;return t.toLowerCase().indexOf(e.toLowerCase())>-1},t.Post=function(t){$(".chat .messages").append(n(t)),this.View().updateChatScroll()},t.Chat=function(t){window.turntable.sendMessage({api:"room.speak",roomid:this.View().roomId,section:this.View().section,text:t})},t.Batch=function(t){if((t=t.split(";;")).length>3)this.Post({head:"Send Error!",body:`Message contains ${t.length}/3 Messages.`});else for(let e of t)this.Chat(e.trim())}};const n=t=>`\n  <div class="message ${t.type||""}"><em>\n    <span class="subject">${t.head||""}</span>\n    <span class="text">${t.body||""}</span>\n  </em></div>\n`}));let T=window.$tS={};var P;(P=T).now=()=>(new Date).toLocaleTimeString("en-us"),P.cap=t=>t[0].toUpperCase()+t.substring(1),P.classes=(t,e)=>{let n=$("body").hasClass(t);e&&!n&&$("body").addClass(t),n&&!e&&$("body").removeClass(t)},q({})(P),C({})(P),j({})(P),S({})(P),x({})(P),k({})(P),P.on("attach",(function(){this.bindLogs(),this.bindTimer(),this.canNotify()})),(t=>{_({})(t),v({})(t),w({})(t),y({})(t),t.readConfig=function(){let t=this.__sync||{},e=window.localStorage.getItem("tsdb");return e=e?JSON.parse(e):{},{...e,...t}},t.writeConfig=function(){let t=JSON.stringify(this.config);window.localStorage.setItem("tsdb",t)},t.initConfig=function(){if(this.__base)return;this.__base=window.tsBase,this.__sync=window.tsSync,this.__logo=this.__base+"/images/icon128.png";let t=this.readConfig(),e={...this.default,...t},n=m({}).version;this.config=this.migrate(e),this.config.version=n,this.config.is_afk=!1,this.Emit("loaded",this.config)},t.saveConfig=function(t){let e=t.target.dataset;if(!e.opt&&!e.for)return;let n=e.for||e.opt,s="checkbox"==t.target.type?t.target.checked:t.target.value;e.for&&(s=$(`*[data-opt="${n}"]`).val()),this.setConfig(n,s,e.cat),(!this.lobby||["style","theme","u_css","hotbar","macros"].includes(n))&&this.Emit("update",n,s,s.cat)},t.setConfig=function(t,e,n){n?this.config[n][t]=e:this.config[t]=e,this.writeConfig();let s="boolean"==typeof e;$(`*[data-opt="${t}"][data-cat="${n||""}"]`).prop(s?"checked":"value",e)}})(T),(t=>{b({})(t),f({})(t),p({})(t),g({})(t),t.on("attach",(function(){this.bindHotBar(),this.bindWindow()}))})(T),(t=>{c({})(t),u({})(t),d({})(t),h({})(t),r({})(t),l({})(t),a({})(t),i({})(t),o({})(t),s({})(t),n({})(t),e({})(t),t.on("loaded",(function(t){this.loadThemes(t),this.loadClasses(t)})),t.on("attach",(function(){this.autoBop(),this.bindPlaylist()}))})(T),(()=>{if(!window.tsBase){let t="https://ts.pixelcrisis.co",e=`Oops! Something went wrong with turnStyles! \n\t\tIf this is a bookmarklet, you may need to update it.\n\t\tTo update, view the ts website at ${t} \n\t\tClicking OK will attempt to open the turnStyles website in a new tab.`,n=()=>window.open(t,"_blank");return window.confirm(e)&&n(),!1}T.attach()})()}();