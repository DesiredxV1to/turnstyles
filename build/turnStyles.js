!function(){var t,e,n=(t=function(t,e){t.exports={version:"5.7.0"}},function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports});const s=function(t,e){for(let n in t){let s=t[n];if(null!=s&&s[e])return s}};const i=t=>`\n  <div id="ts_hotbar">\n    <div class="ts_wrap">\n      <h1>\u2261 tS</h1>\n      ${a(t,"is_afk","AFK")}\n      ${a(t,"autobop","Autobop")}\n      ${a(t,"nextdj","Next DJ")}\n      ${a(t,"auto_q","AutoQueue")}\n    </div>\n  </div>\n`,o=t=>`\n  <div id="ts_panel">\n    <h1>\n      turnStyles\n      <small>v${t.config.version}</small>\n      <span class="ts_close">\u2716</span>\n    </h1>\n\n    <div class="active ts_section">\n      <h4>General</h4>\n      <div class="ts_content">\n        ${a(t,"autobop","Autobop")}\n        ${a(t,"has_vol","Control Volume")}\n        ${a(t,"nextdj","Next DJ Spot")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>UI Options</h4>\n      <div class="ts_content">\n        ${l(t,"theme")}\n        ${l(t,"style")}\n        ${a(t,"no_bub","Hide Chat Bubbles")}\n        ${a(t,"no_aud","Hide Audience")}\n        ${a(t,"no_vid","Hide Player")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Auto-Queue</h4>\n      <div class="ts_content">\n        ${a(t,"auto_q","Enable")}\n        <p>Paste your bot's queue message below to take the decks automatically when you're called.</p>\n        ${r(t,"q_ping")}\n        ${d("q_ping","Save Queue Ping")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>AFK Reminder</h4>\n      <div class="ts_content">\n        ${a(t,"is_afk","Go AFK")} \n        <p>Sends the response when you go AFK, and if you get pinged while gone.</p>\n        ${r(t,"afk_ping")}\n        ${d("afk_ping","Save AFK Response")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Bulletins</h4>\n      <div class="ts_content">\n        ${l(t,"remind",!0)} \n        <p>Send an automated message at a set interval in your room - message prefixed with [tS]</p>\n        ${r(t,"reminder")}\n        ${d("reminder","Save Bulletin")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Data In Chat</h4>\n      <div class="ts_content">\n        ${a(t,"chat_song","Last Song Stats")}\n        ${a(t,"chat_spun","Dropped DJ Stats")}\n        ${a(t,"chat_snag","User Snags")}\n        ${a(t,"chat_join","User Joins")}\n        ${a(t,"chat_left","User Leaves")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Notifications</h4>\n      <div class="ts_content">\n        ${a(t,"ping_pm","On DMs")}\n        ${a(t,"ping_chat","On Mentions")}\n        ${a(t,"ping_song","On New Songs")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Hot words</h4>\n      <div class="ts_content">\n        <p>Sends a notification and highlights message on word match in chat. Use multiple words in a comma separated list.</p>\n        ${r(t,"hot_words")}\n        ${d("hot_words","Save Hot Words")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Custom CSS</h4>\n      <div class="ts_content">\n        <textarea id="ts_user_css" rows="10">${t.config.user_css}</textarea>\n        ${d("user_css","Save And Apply Styles")}\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>About / Extras</h4>\n      <div class="ts_content">\n        <a class="ts_link" href="https://chrome.google.com/webstore/detail/turntable-tweaks/pmlkackfnbbnjfejpddpakallilkbdme" target="_blank">Chrome Store</a>\n        <a class="ts_link" href="https://addons.mozilla.org/en-US/firefox/addon/turnstyles-for-turntable-fm/" target="_blank">Firefox Addon</a>\n        <a class="ts_link" href="https://ts.pixelcrisis.co" target="_blank">Bookmarklets</a>\n\n        <br>\n        <a class="ts_link" href="https://discord.gg/ZprHwNUw8y" target="_blank">turnStyles Discord</a>\n        <a class="ts_link" href="https://discord.gg/jnRs4WnPjM" target="_blank">Turntable.fm Discord</a>\n        <br><strong>ON TURNTABLE: <em>@crisis</em></strong>\n\n        <br>\n        <a class="ts_link" href="https://github.com/pixelcrisis/turnstyles" target="_blank">turnStyles github</a>\n        <a class="ts_link" href=""https://github.com/fluteds/ttscripts target="_blank">ttscripts (themes + more)</a>\n      </div>\n    </div>\n\n    <div class="ts_section">\n      <h4>Debugging</h4>\n      <div class="ts_content">\n        ${a(t,"logging","Show Logs In Room Tab")} \n        ${h("reloadMusic","Fix Glitched Players")}\n        ${h("reload","Reload turnStyles")}\n      </div>\n    </div>\n  </div>\n`,a=(t,e,n)=>`\n  <label>\n    <input data-for="${e}" class="ts_option" type="checkbox"\n      ${t.config[e]?"checked":""}>\n    </input>\n    <span></span> ${n}\n  </label>\n`,l=(t,e,n)=>{return`\n  <select data-for="${e}" class="ts_option">\n    ${n?"":(s=e,`<option value="">No ${i=s,i[0].toUpperCase()+i.substring(1)}</option>`)}\n    ${Object.keys(t.options[e]).map(n=>`\n      <option value="${n}" ${t.config[e]==n?"selected":""}>\n        ${t.options[e][n]}\n      </option>\n    `).join("")}\n  </select>\n`;var s,i},r=(t,e)=>`\n  <input type="text" \n    id="ts_${e}" value="${t.config[e]}">\n  </input>\n`,d=(t,e)=>`\n  <button class="ts_optbtn" data-for="ts_${t}">${e}</button>\n`,h=(t,e)=>`\n  <button onclick="$tS.${t}()">${e}</button>\n`;const c=function(t){let e=document.createElement("style");e.classList.add("tScss"),e.type="text/css",e.innerHTML=t,$("style.tScss").remove(),document.head.append(e)},u=function(t,e,n){return`${n?`${t}/${n}`:""+t}/${e}.css`},g=function(t,e,n){if(!e)return;let s=document.createElement("link");s.classList.add("tS-"+(n||"core")),s.type="text/css",s.rel="stylesheet",s.href=u(t,e,n),document.head.append(s)},p=function(t,e,n){let s=$("link.tS-"+n);if(!e)return!!s.length&&s.remove();s.length?s.attr("href",u(t,e,n)):g(t,e,n)};const m=(t,e,n)=>$(t).on("DOMSubtreeModified",e,n),f=function(){let t=window.turntable.playlist;t.isFiltering&&t.clearSearchBar(),$("#queue-header").removeClass("normal").addClass("edit"),t.queue.batchEditMode()},_=function(){let t=$("#playlist-header .text")[0],e=window.turntable.playlist.fileids.length,n=t.innerHTML.split("<em>")[0];t.innerHTML=`${n} <em>${e}</em>`},v=function(){if($(".profile.modal .statslink").length)return;let t=$(".profile.modal .userid"),e=t.length?t[0].innerHTML:"";24==e.length&&($(".profile.modal .section.web-links").show(),$(".profile.modal .website").append(`\n    <a class="statslink" href="https://ttstats.info/user/${e}" \n      target="_blank" onclick="$('.modal .close-x')[0].click()">\n      ttStats Profile\n    </a>\n  `))};const b=t=>Math.log(t/100)/Math.LN2+4,w=t=>{let e=t||window.util.getSetting("volume");return 100*Math.pow(2,e-4)};const k=()=>{$(window).focus();let t={bubbles:!0,cancelable:!0,view:window},e=document.querySelectorAll(".awesome-button")[0],n=new MouseEvent("click",t);return!e.dispatchEvent(n)};const y={};(t=>{t.default={logging:!1,theme:"dark",style:"",autobop:!0,nextdj:!1,auto_q:!1,q_ping:"Hey @user - it's your turn!",has_vol:!1,no_aud:!1,no_vid:!1,no_bub:!1,ping_pm:!1,ping_song:!1,ping_chat:!1,hot_words:"",chat_song:!1,chat_spun:!1,chat_snag:!1,chat_join:!1,chat_left:!1,is_afk:!1,afk_ping:"I'm AFK - Back in a sec!",beats:0,remind:0,reminder:"Today's theme is: Cool.",user_css:""},t.options={theme:{dark:"Dark Mode",night:"Night Mode",forest:"Forest",cosmic:"Cosmic",midnight:"Midnight"},style:{pink:"Pink",blue:"Blue",teal:"Teal",green:"Green",purple:"Purple"},remind:{0:"Don't Remind",15:"Every 15m",30:"Every 30m",60:"Every 1h",120:"Every 2h"}}})(y),(t=>{t.on=function(t,e){this.events||(this.events={}),this.events[t]||(this.events[t]=[]),this.events[t].push(e.bind(this))},t.emit=function(t,e,n){let s=this.events[t];if(s)for(let i of s)i(e,n)},t.handle=function(t){t.command&&(t.$ping=this.pinged(t.text),t.$name=this.userName(t.userid),t.$from=this.buddyName(t.senderid),t.$self=t.userid==window.turntable.user.id,this.emit(t.command,t))},t.events={}})(y),(t=>{t.view=()=>window.turntable.topViewController,t.userName=t=>{let e=window.turntable.topViewController.userMap[t];return e?e.attributes.name:"Someone"},t.buddyName=t=>{let e=window.turntable.buddyList.pmWindows[t];return!!e&&e.otherUser.attributes.name},t.pinged=t=>{let e="@"+window.turntable.user.attributes.name;return t&&t.toLowerCase().indexOf(e.toLowerCase())>-1},t.speak=t=>{let e={api:"room.speak",text:t,roomid:window.turntable.topViewController.roomId,section:window.turntable.topViewController.section};window.turntable.sendMessage(e)},t.reloadMusic=()=>{let t=window.youtube,e=window.soundcloudplayer;e.song&&(e.songTime=e.player.currentTime()/1e3,e.previewStartTime=Date.now()-1e3,e.resumeSong(e.song)),t.song&&(t.songTime=t.player[0].getCurrentTime(),t.previewStartTime=Date.now()-3e3,t.resumeSong(t.song)),$("#turnStyles").removeClass("active")},t.toggleClass=(t,e)=>{let n=$("body").hasClass(t);e&&!n&&$("body").addClass(t),n&&!e&&$("body").removeClass(t)}})(y),(t=>{t.on("attach",(function(t){for(let e of t.djids)this.cacheNewDJ(e);this.cacheTrack(t.currentSong)})),t.on("update_votes",(function(t){this.now_playing.love=t.room.metadata.upvotes,this.now_playing.hate=t.room.metadata.downvotes})),t.on("snagged",(function(){this.now_playing.snag+=1})),t.cacheNewDJ=function(t,e){let n=t.user?t.user[0].userid:t,s=this.current_djs[n],i=this.userName(n);s||(this.current_djs[n]={spun:e&&e.spun?e.spun:0,love:e&&e.love?e.love:0,hate:e&&e.hate?e.hate:0,snag:e&&e.snag?e.snag:0}),this.Log(`new dj: [${i}](${n})`)},t.clearOldDJ=function(t){let e=t.user[0].name,n=t.user[0].userid;if(!this.current_djs[n])return;let s={...this.current_djs[n]},i=`${s.love}\u2764\ufe0f${s.hate}\ud83d\udc94${s.snag}\ud83d\udc96${s.spun}\u25b6\ufe0f`;delete this.current_djs[n],this.Log(`old dj: [${e}] (${n})`),this.emit("dropped",e,i)},t.cacheTrack=function(t){let e=t&&t.room?t.room.metadata.current_song:t,n=t&&t.upvoters?t.upvoters.length:0,s=!!e&&e.djid,i={...this.now_playing},o={love:n,hate:0,snag:0,dj:s};this.last_played=i,this.now_playing=e?{...e.metadata,...o}:{},i.song&&this.current_djs[i.dj]?(this.current_djs[i.dj].spun+=1,this.current_djs[i.dj].love+=i.love,this.current_djs[i.dj].hate+=i.hate,this.current_djs[i.dj].snag+=i.snag):i.song&&this.cacheNewDJ(i.dj,i);let a=!1;i.song&&(a=`${i.love}\u2764\ufe0f${i.hate}\ud83d\udc94${i.snag}\ud83d\udc96`),this.Log("new song: "+(this.now_playing.song||"none")),this.emit("tracked",a)},t.on("add_dj",t.cacheNewDJ),t.on("rem_dj",t.clearOldDJ),t.on("nosong",t.cacheTrack),t.on("newsong",t.cacheTrack),t.last_played={},t.now_playing={},t.current_djs={}})(y),(t=>{t.init=function(){this.__base=window.tsBase||"https://ts.pixelcrisis.co/build";let t=window.localStorage.getItem("tsdb"),e=t?JSON.parse(t):{},s=n({}).version;this.config={...this.default,...e,version:s},this.config.is_afk=!1,this.emit("loaded",this.config),this.attach()},t.attach=function(){let e=window.turntable;if(!e)return this.Log("no room");if(this.lobby=$("#turntable #topBG").length,this.lobby)return this.buildWindow();let n=()=>setTimeout(t.attach.bind(this),150);if(!e.user)return n();let i=s(e,"roomId");return i&&s(i,"roomData")?(this.handler=this.handle.bind(this),window.turntable.addEventListener("message",this.handler),this.emit("attach",i),void this.Log("loaded room")):n()},t.reload=function(){clearInterval(this.heart),window.turntable.removeEventListener("message",this.handler),$('script[src*="turnStyles.js"]').remove();const t=document.createElement("script");t.src=`${this.__base}/turnStyles.js?${Math.random()}`,t.type="text/javascript",this.Log("reloading"),document.body.append(t)}})(y),(t=>{t.saveConfig=function(t){let e=t.target.dataset.for,n="checkbox"==t.target.type?t.target.checked:t.target.value;0===e.indexOf("ts_")&&(n=$("#"+e).val(),e=e.split("ts_").join("")),this.writeConfig(e,n),!["style","theme","user_css"].includes(e)&&this.lobby||this.emit("update",e,n)},t.writeConfig=function(t,e){this.config[t]=e;let n=JSON.stringify(this.config);window.localStorage.setItem("tsdb",n);let s="boolean"==typeof e;$(`*[data-for="${t}"]`).prop(s?"checked":"value",e)}})(y),(t=>{t.Log=function(t){let e=`[${(new Date).toLocaleTimeString("en-us")}]`;console.info(`${e} turnStyles :: ${t}`),this.logBook.push(`[tS] ${e} <span>${t}</span>`),this.Logged()},t.Logged=function(){this.logBook.length>50&&this.logBook.shift();let t=$("#ts_logs")[0];t&&(t.innerHTML=this.logBook.join("<br>"),t.scrollTop=t.scrollHeight)},t.logBook=[]})(y),(t=>{t.suspend=function(t,e,n){this.holding||(this.holding={}),this.holding[n]?clearTimeout(this.holding[n]):t&&t();let s=1e3*e;this.holding[n]=setTimeout((()=>{delete this.holding[n]}).bind(this),s)},t.holding={}})(y),(t=>{t.beat=function(){this.config.beats=parseInt(this.config.beats)+1,this.emit("heartbeat",this.config.beats)},t.on("attach",(function(){this.heart=setInterval(t.beat.bind(this),6e4)}))})(y),(t=>{t.on("attach",(function(){$("#ts_hotbar").remove(),$(".header-bar").append(i(this)),$("#ts_hotbar h1").on("click",this.togglePanel.bind(this)),$("#ts_hotbar .ts_optbtn").on("click",this.saveConfig.bind(this)),$("#ts_hotbar .ts_option").on("change",this.saveConfig.bind(this))})),t.togglePanel=function(){let t=$("#ts_panel");if(t.length)return t.remove();let e=$(".right-panel.tabs-3").length;$((e?".right-panel":".left-panel")+" .selected .tab-pane").append(o(window.$tS)),$(".ts_section > h4").on("click",t=>{$(".ts_section.active").removeClass("active"),$(t.currentTarget).parent().addClass("active")}),$(".ts_close").on("click",()=>$("#ts_panel").remove()),$("#ts_panel .ts_optbtn").on("click",this.saveConfig.bind(this)),$("#ts_panel .ts_option").on("change",this.saveConfig.bind(this))}})(y),(t=>{t.on("loaded",(function(t){$("link.tS-core").remove(),g(this.__base,"turnStyles"),$("link.tS-themes").remove(),g(this.__base,t.theme,"themes"),$("link.tS-styles").remove(),g(this.__base,t.style,"styles"),c(t.user_css)})),t.on("update",(function(t,e){"theme"==t&&p(this.__base,e,"themes"),"style"==t&&p(this.__base,e,"styles"),"user_css"==t&&c(e)}))})(y),(t=>{t.on("attach",(function(){_(),m("#songs-wrapper","#songs",_),m("#maindiv",".overlay .profile",v),$("#upload-button").after('<div id="ts_upload"></div>'),$("#ts_upload").on("click",f),this.toggleClass("ts_hide_videos",this.config.no_vid),this.toggleClass("ts_hide_audience",this.config.no_aud),this.toggleClass("ts_hide_bubbles",this.config.no_bub),this.toggleClass("ts_has_logging",this.config.logging)})),t.on("update",(function(t,e){"no_vid"==t&&this.toggleClass("ts_hide_videos",e),"no_aud"==t&&this.toggleClass("ts_hide_audience",e),"no_bub"==t&&this.toggleClass("ts_hide_bubbles",e),"logging"==t&&this.toggleClass("ts_has_logging",e)}))})(y),(t=>{t.loadVolume=function(){let t=this.config.has_vol,e=$("body").hasClass("has-volume");this.toggleClass("has-volume",t);let n=window.turntablePlayer.realVolume;this.realVolume||(this.realVolume=n),e&&!t&&this.remVolume(),t&&!e&&this.addVolume()},t.addVolume=function(){$(".header-content").append(`\n      <div id="ts_volume">\n        <span id="ts_mute"></span>\n        <input id="ts_slider" type="range" \n          min="0" max="100" value="${w()}">\n        </input>\n        <em id="ts_muted">Muted For One Song</em>\n      </div>\n    `),$("#ts_mute").on("click",this.toggleMute.bind(this)),$("#ts_slider").on("input",this.saveVolume.bind(this)),$("#ts_slider").on("DOMMouseScroll mousewheel",this.onVolWheel.bind(this))},t.remVolume=function(){$("#ts_volume").remove(),window.turntablePlayer.realVolume=this.realVolume},t.saveVolume=function(t){let e=(t=t.target?t.target.value:t)>0?b(t):-3;window.turntablePlayer.realVolume=e>6?this.realVolume:w,window.turntablePlayer.setVolume(e),window.util.setSetting("volume",e)},t.onVolWheel=function(t){const e=w();let n=t.originalEvent.shiftKey?1:5,s=t.originalEvent.deltaY>0?e-n:e+n;return s=s<0?0:s>100?100:s,$("#ts_slider")[0].value=s,this.saveVolume(s),!1},t.toggleMute=function(){this.mute=!this.mute,$("#ts_volume").toggleClass("muted",this.mute);let t=this.mute?-3:b(w());window.turntablePlayer.setVolume(t),this.Log("turned mute "+(this.mute?"on":"off"))},t.checkMuted=function(){this.mute&&this.toggleMute()},t.on("attach",t.loadVolume),t.on("update",t.loadVolume),t.on("nosong",t.checkMuted),t.on("newsong",t.checkMuted)})(y),(t=>{t.on("update",(function(t,e){if("is_afk"!=t)return;let n=this.config.afk_ping;e&&n&&this.speak(n)})),t.on("speak",(function(t){let e=this.config.is_afk,n=this.config.afk_ping;!t.$self&&t.$ping&&e&&n?this.speak(n):t.$self&&e&&t.text!=n&&(this.writeConfig("is_afk",!1),this.postToChat("Welcome Back!","I've turned off AFK for you!","stat"))}))})(y),(t=>{t.on("tracked",(function(t){let e=this.now_playing,n=this.last_played;if(e.song&&this.config.ping_song){let n="Now Playing: "+e.song,s=t||"By: "+e.artist;this.notifyUser(n,s)}if(t&&this.config.chat_song){let e=`${n.song} by ${n.artist}`;this.postToChat(t,e,"stat")}})),t.on("dropped",(function(t,e){if(!this.config.chat_spun)return;let n=`${t} - ${e}`;this.postToChat(n," - is done spinning!","stat")}))})(y),(t=>{t.checkDecks=function(){if(this.config.nextdj)return $(".become-dj").length?(this.Log("nextdj: taking spot"),void this.view().becomeDj()):this.Log("nextdj: no spot")},t.on("add_dj",(function(t){if(!this.config.nextdj)return;if(window.turntable.user.id!=t.user[0].userid)return;let e="You've Hopped On Deck!",n="NextDJ is now disabled.";this.notifyUser(e,n),this.postToChat(e,n),this.writeConfig("nextdj",!1)})),t.on("speak",(function(t){this.config.auto_q&&this.config.q_ping==t.text&&this.view().becomeDj()})),t.on("attach",t.checkDecks),t.on("update",t.checkDecks),t.on("rem_dj",t.checkDecks)})(y),(t=>{t.notifyAuth=function(){let t=this.config;return!(!(t.ping_chat||t.ping_pm||t.ping_song)||!("Notification"in window)||"denied"===Notification.permission||"default"===Notification.permission&&(this.Log("requesting notifcation permission"),Notification.requestPermission(),1))},t.notifyUser=function(t,e,n){if(!this.notifyAuth()||document.hasFocus())return;let s=this.__base+"/images/icon128.png",i=()=>{let n=new Notification(t,{icon:s,body:e});n.onclick=()=>{window.focus(),n.close()}};return n?this.suspend(i,5,n):i()},t.postToChat=function(t,e,n){$(".chat .messages").append(`\n      <div class="message ${n}">\n        <em>\n          <span class="subject">${t}</span>\n          <span class="text">${e}</span>\n        </em>\n      </div>\n    `),this.view().updateChatScroll()},t.on("attach",t.notifyAuth),t.on("update",t.notifyAuth)})(y),(t=>{t.on("pmmed",(function(t){if(!this.config.ping_pm)return;let e="New PM "+(t.$from?"from: "+t.$from:"");this.notifyUser(e,t.text,"pm_ping")})),t.on("speak",(function(t){if(!t.$ping||!this.config.ping_chat)return;let e=`[${this.view().roomData.name}] @${t.name}`;this.notifyUser(e,t.text,"chat_ping")})),t.on("speak",(function(t){let e=this.config.hot_words.split(",");for(let n of e){let e=t.text.toLowerCase(),s=n.trim().toLowerCase();if(e.indexOf(s)>-1){$(".chat .messages .message:last-child").addClass("mention");let e=`[${this.view().roomData.name}] Found: ${n}`;return this.notifyUser(e,t.text,"match_ping")}}})),t.on("snagged",(function(t){this.config.chat_snag&&this.postToChat(t.$name,"has snagged this track!","snag")})),t.on("registered",(function(t){for(let e of t.user)this.Log(`[${e.name}](${e.userid}) joined.`),this.config.chat_join&&this.postToChat(e.name,"joined.","join")})),t.on("deregistered",(function(t){for(let e of t.user)this.Log(`[${e.name}](${e.userid}) left.`),this.config.chat_join&&this.postToChat(e.name,"left.","left")})),t.on("update_votes",(function(t){let e=t.room.metadata.votelog,n=e[e.length-1],s=this.userName(n[0]);this.Log(`[${s}] voted: ${n[1]}`)}))})(y),(t=>{t.autoBop=function(){if(this.bopping&&clearTimeout(this.bopping),!this.config.autobop)return;let t=7*Math.random()*100;this.bopping=setTimeout(k,t)},t.on("attach",t.autoBop),t.on("newsong",t.autoBop)})(y),(t=>{t.on("heartbeat",(function(t){let e=this.config.reminder;t%parseInt(this.config.remind)==0&&e&&this.speak("[tS] "+e)}))})(y),window.$tS=y,window.$tS.init()}();